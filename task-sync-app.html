<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f0f0f">
  <meta name="description" content="Shared task and inventory management">
  <link rel="manifest" href="manifest.json">
  <title>TaskSync</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Work+Sans:wght@400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --bg-primary: #0f0f0f;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #242424;
      --bg-elevated: #2a2a2a;
      
      --text-primary: #e8e8e8;
      --text-secondary: #a0a0a0;
      --text-tertiary: #707070;
      
      --accent-task: #4a9eff;
      --accent-inventory: #00d9a3;
      --accent-checklist: #ff6b9d;
      --accent-warning: #ffb84d;
      
      --border-subtle: #2a2a2a;
      --border-medium: #404040;
      
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      
      --font-body: 'Work Sans', -apple-system, sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
    }
    
    body {
      font-family: var(--font-body);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    
    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0;
      min-height: 100vh;
    }
    
    /* Header */
    .app-header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }
    
    .app-title {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: -0.5px;
    }
    
    .header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .user-info {
      font-size: 14px;
      color: var(--text-secondary);
      font-family: var(--font-mono);
    }
    
    /* Auth Screen */
    .auth-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .auth-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-lg);
      padding: 40px;
      max-width: 400px;
      width: 100%;
      box-shadow: var(--shadow-lg);
    }
    
    .auth-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      text-align: center;
    }
    
    .auth-subtitle {
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: 32px;
      font-size: 14px;
    }
    
    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .form-input {
      background: var(--bg-primary);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-sm);
      padding: 12px 16px;
      color: var(--text-primary);
      font-size: 15px;
      font-family: var(--font-body);
      transition: all 0.2s;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--accent-task);
      box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
    }
    
    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-weight: 600;
      font-family: var(--font-body);
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-primary {
      background: var(--accent-task);
      color: white;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: #3a8eef;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
    }
    
    .btn-secondary {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-medium);
    }
    
    .btn-secondary:hover {
      background: var(--bg-tertiary);
    }
    
    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border-medium);
    }
    
    .btn-ghost:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 13px;
    }
    
    .btn-danger {
      background: rgba(255, 77, 77, 0.15);
      color: #ff6b6b;
      border: 1px solid rgba(255, 77, 77, 0.3);
    }
    
    .btn-danger:hover:not(:disabled) {
      background: rgba(255, 77, 77, 0.25);
    }
    
    /* Main Content */
    .main-content {
      padding: 24px 20px;
    }
    
    .view-controls {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .view-tabs {
      display: flex;
      gap: 4px;
      background: var(--bg-secondary);
      padding: 4px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-subtle);
    }
    
    .view-tab {
      padding: 8px 16px;
      background: transparent;
      color: var(--text-secondary);
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: var(--font-body);
    }
    
    .view-tab.active {
      background: var(--bg-elevated);
      color: var(--text-primary);
    }
    
    /* Task Lists */
    .lists-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }
    
    .list-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 20px;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .list-card:hover {
      border-color: var(--border-medium);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }
    
    .list-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .list-meta {
      font-size: 12px;
      color: var(--text-tertiary);
      font-family: var(--font-mono);
    }
    
    .list-type-badge {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-family: var(--font-mono);
    }
    
    .badge-task {
      background: rgba(74, 158, 255, 0.15);
      color: var(--accent-task);
    }
    
    .badge-inventory {
      background: rgba(0, 217, 163, 0.15);
      color: var(--accent-inventory);
    }
    
    .badge-checklist {
      background: rgba(255, 107, 157, 0.15);
      color: var(--accent-checklist);
    }
    
    .task-preview {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .task-preview-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: var(--bg-primary);
      border-radius: 6px;
      font-size: 14px;
    }
    
    .task-checkbox {
      width: 16px;
      height: 16px;
      border: 2px solid var(--border-medium);
      border-radius: 4px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .task-checkbox.checked {
      background: var(--accent-task);
      border-color: var(--accent-task);
    }
    
    .task-checkbox.checked::after {
      content: 'âœ“';
      color: white;
      font-size: 12px;
    }
    
    /* Today View */
    .today-tasks {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .task-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-left: 3px solid;
      border-radius: var(--radius-sm);
      padding: 16px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .task-item:hover {
      border-color: var(--border-medium);
      box-shadow: var(--shadow-sm);
    }
    
    .task-item.type-task {
      border-left-color: var(--accent-task);
    }
    
    .task-item.type-inventory {
      border-left-color: var(--accent-inventory);
    }
    
    .task-item.type-checklist {
      border-left-color: var(--accent-checklist);
    }
    
    .task-content {
      flex: 1;
    }
    
    .task-name {
      font-size: 15px;
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .task-meta {
      display: flex;
      gap: 12px;
      font-size: 13px;
      color: var(--text-secondary);
      flex-wrap: wrap;
    }
    
    .task-list-name {
      font-family: var(--font-mono);
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
      animation: fadeIn 0.2s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background: var(--bg-secondary);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-lg);
      padding: 24px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      animation: slideUp 0.3s;
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 600;
    }
    
    .close-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.2s;
    }
    
    .close-btn:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
    }
    
    .modal-body {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .select-input {
      background: var(--bg-primary);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-sm);
      padding: 12px 16px;
      color: var(--text-primary);
      font-size: 15px;
      font-family: var(--font-body);
      cursor: pointer;
    }
    
    .select-input:focus {
      outline: none;
      border-color: var(--accent-task);
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }
    
    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .empty-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .empty-text {
      color: var(--text-secondary);
      margin-bottom: 24px;
    }
    
    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-secondary);
      gap: 12px;
    }
    
    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--border-medium);
      border-top-color: var(--accent-task);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Alert */
    .alert {
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      margin-bottom: 16px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .alert-error {
      background: rgba(255, 77, 77, 0.15);
      color: #ff6b6b;
      border: 1px solid rgba(255, 77, 77, 0.3);
    }
    
    .alert-success {
      background: rgba(0, 217, 163, 0.15);
      color: var(--accent-inventory);
      border: 1px solid rgba(0, 217, 163, 0.3);
    }
    
    .alert-info {
      background: rgba(74, 158, 255, 0.15);
      color: var(--accent-task);
      border: 1px solid rgba(74, 158, 255, 0.3);
    }
    
    /* Fab Button */
    .fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--accent-task);
      color: white;
      border: none;
      font-size: 24px;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      z-index: 99;
    }
    
    .fab:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 8px 24px rgba(74, 158, 255, 0.4);
    }
    
    /* Quantity Controls */
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 16px;
      justify-content: center;
      padding: 20px;
      background: var(--bg-primary);
      border-radius: var(--radius-md);
    }
    
    .quantity-btn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--bg-elevated);
      border: 2px solid var(--border-medium);
      color: var(--text-primary);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      font-weight: 600;
    }
    
    .quantity-btn:hover:not(:disabled) {
      background: var(--bg-tertiary);
      border-color: var(--accent-inventory);
      transform: scale(1.1);
    }
    
    .quantity-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .quantity-display {
      font-size: 32px;
      font-weight: 600;
      font-family: var(--font-mono);
      min-width: 80px;
      text-align: center;
      color: var(--accent-inventory);
    }
    
    /* Checklist */
    .checklist-items {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .checklist-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-primary);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--border-subtle);
    }
    
    .checklist-item:hover {
      background: var(--bg-tertiary);
      border-color: var(--border-medium);
    }
    
    .checklist-checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-medium);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s;
    }
    
    .checklist-checkbox.checked {
      background: var(--accent-checklist);
      border-color: var(--accent-checklist);
    }
    
    .checklist-checkbox.checked::after {
      content: 'âœ“';
      color: white;
      font-size: 14px;
      font-weight: bold;
    }
    
    .checklist-label {
      flex: 1;
      font-size: 15px;
    }
    
    .checklist-label.checked {
      text-decoration: line-through;
      opacity: 0.6;
    }
    
    .add-checklist-item {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    
    /* Share Section */
    .share-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border-subtle);
    }
    
    .share-title {
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }
    
    .shared-users {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .shared-user-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      background: var(--bg-primary);
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-family: var(--font-mono);
    }
    
    .task-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .lists-grid {
        grid-template-columns: 1fr;
      }
      
      .view-controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .view-tabs {
        width: 100%;
      }
      
      .modal-content {
        padding: 20px;
        max-width: 100%;
      }
      
      .task-actions {
        flex-direction: column;
      }
      
      .task-actions .btn {
        width: 100%;
      }
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Firebase Configuration (built-in)
    const firebaseConfig = {
      apiKey: " ",
      authDomain: "tasksync-d1512.firebaseapp.com",
      databaseURL: "https://tasksync-d1512-default-rtdb.europe-west1.firebasedatabase.app/",
      projectId: "tasksync-d15l2",
      storageBucket: "tasksync-d15l2.firebasestorage.app",
      messagingSenderId: "372192891626",
      appId: "1:372192891626:web:24721f22cb04f902cc3d93"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Main App Component
    function App() {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
          setUser(user);
          setLoading(false);
        });

        return () => unsubscribe();
      }, []);

      if (loading) {
        return (
          <div className="loading">
            <div className="spinner"></div>
            <span>Loading...</span>
          </div>
        );
      }

      if (!user) {
        return <AuthScreen />;
      }

      return <MainApp user={user} />;
    }

    // Auth Screen
    function AuthScreen() {
      const [isLogin, setIsLogin] = useState(true);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        try {
          if (isLogin) {
            await firebase.auth().signInWithEmailAndPassword(email, password);
          } else {
            await firebase.auth().createUserWithEmailAndPassword(email, password);
          }
        } catch (err) {
          let errorMessage = err.message;
          if (err.code === 'auth/user-not-found') {
            errorMessage = 'No account found with this email. Please sign up.';
          } else if (err.code === 'auth/wrong-password') {
            errorMessage = 'Incorrect password. Please try again.';
          } else if (err.code === 'auth/email-already-in-use') {
            errorMessage = 'Email already in use. Please sign in instead.';
          } else if (err.code === 'auth/weak-password') {
            errorMessage = 'Password should be at least 6 characters.';
          }
          setError(errorMessage);
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="auth-screen">
          <div className="auth-card">
            <div className="auth-title">TaskSync</div>
            <div className="auth-subtitle">
              {isLogin ? 'Welcome back' : 'Create your account'}
            </div>

            {error && <div className="alert alert-error">{error}</div>}

            <form onSubmit={handleSubmit} className="auth-form">
              <div className="form-group">
                <label className="form-label">Email</label>
                <input
                  type="email"
                  className="form-input"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  required
                  autoComplete="email"
                />
              </div>

              <div className="form-group">
                <label className="form-label">Password</label>
                <input
                  type="password"
                  className="form-input"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  required
                  minLength={6}
                  autoComplete={isLogin ? "current-password" : "new-password"}
                />
              </div>

              <button type="submit" className="btn btn-primary" disabled={loading}>
                {loading ? 'Loading...' : (isLogin ? 'Sign In' : 'Sign Up')}
              </button>

              <button
                type="button"
                className="btn btn-ghost"
                onClick={() => {
                  setIsLogin(!isLogin);
                  setError('');
                }}
              >
                {isLogin ? 'Need an account? Sign up' : 'Have an account? Sign in'}
              </button>
            </form>
          </div>
        </div>
      );
    }

    // Main App (after login)
    function MainApp({ user }) {
      const [lists, setLists] = useState([]);
      const [currentView, setCurrentView] = useState('today');
      const [showModal, setShowModal] = useState(false);
      const [selectedList, setSelectedList] = useState(null);
      const [selectedTask, setSelectedTask] = useState(null);

      useEffect(() => {
        const listsRef = firebase.database().ref('lists');
        
        listsRef.on('value', (snapshot) => {
          const data = snapshot.val();
          if (data) {
            const listsArray = Object.keys(data).map(key => ({
              id: key,
              ...data[key]
            })).filter(list => 
              list.owner === user.uid || 
              (list.sharedWith && list.sharedWith.includes(user.uid))
            );
            setLists(listsArray);
          } else {
            setLists([]);
          }
        });

        return () => listsRef.off();
      }, [user]);

      const handleSignOut = () => {
        firebase.auth().signOut();
      };

      const getTodayTasks = () => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const tasks = [];
        
        lists.forEach(list => {
          if (list.tasks) {
            Object.keys(list.tasks).forEach(taskId => {
              const task = list.tasks[taskId];
              if (task.nextDue) {
                const dueDate = new Date(task.nextDue);
                dueDate.setHours(0, 0, 0, 0);
                if (dueDate <= today && !task.completed) {
                  tasks.push({
                    ...task,
                    id: taskId,
                    listId: list.id,
                    listName: list.name,
                    listType: list.type
                  });
                }
              }
            });
          }
        });
        
        return tasks.sort((a, b) => new Date(a.nextDue) - new Date(b.nextDue));
      };

      return (
        <div className="app-container">
          <header className="app-header">
            <div className="app-title">TaskSync</div>
            <div className="header-actions">
              <span className="user-info">{user.email}</span>
              <button className="btn btn-secondary btn-small" onClick={handleSignOut}>
                Sign Out
              </button>
            </div>
          </header>

          <main className="main-content">
            <div className="view-controls">
              <div className="view-tabs">
                <button
                  className={`view-tab ${currentView === 'today' ? 'active' : ''}`}
                  onClick={() => setCurrentView('today')}
                >
                  Today
                </button>
                <button
                  className={`view-tab ${currentView === 'lists' ? 'active' : ''}`}
                  onClick={() => setCurrentView('lists')}
                >
                  All Lists
                </button>
              </div>
            </div>

            {currentView === 'today' && (
              <TodayView 
                tasks={getTodayTasks()} 
                onTaskClick={(task) => {
                  setSelectedTask(task);
                  setShowModal(true);
                }} 
              />
            )}
            
            {currentView === 'lists' && (
              <ListsView 
                lists={lists} 
                onListClick={(list) => {
                  setSelectedList(list);
                  setShowModal(true);
                }} 
              />
            )}
          </main>

          <button className="fab" onClick={() => {
            setSelectedList(null);
            setSelectedTask(null);
            setShowModal(true);
          }}>
            +
          </button>

          {showModal && (
            <Modal
              onClose={() => {
                setShowModal(false);
                setSelectedList(null);
                setSelectedTask(null);
              }}
              list={selectedList}
              task={selectedTask}
              user={user}
            />
          )}
        </div>
      );
    }

    // Today View
    function TodayView({ tasks, onTaskClick }) {
      if (tasks.length === 0) {
        return (
          <div className="empty-state">
            <div className="empty-icon">âœ¨</div>
            <div className="empty-title">All clear!</div>
            <div className="empty-text">No tasks due today. Click + to create a list.</div>
          </div>
        );
      }

      return (
        <div className="today-tasks">
          {tasks.map(task => (
            <div
              key={`${task.listId}-${task.id}`}
              className={`task-item type-${task.listType}`}
              onClick={() => onTaskClick(task)}
            >
              <div className={`task-checkbox ${task.completed ? 'checked' : ''}`}></div>
              <div className="task-content">
                <div className="task-name">{task.name}</div>
                <div className="task-meta">
                  <span className="task-list-name">{task.listName}</span>
                  {task.nextDue && <span>Due: {new Date(task.nextDue).toLocaleDateString()}</span>}
                </div>
              </div>
            </div>
          ))}
        </div>
      );
    }

    // Lists View
    function ListsView({ lists, onListClick }) {
      if (lists.length === 0) {
        return (
          <div className="empty-state">
            <div className="empty-icon">ðŸ“‹</div>
            <div className="empty-title">No lists yet</div>
            <div className="empty-text">Create your first list to get started</div>
            <button className="btn btn-primary" style={{marginTop: '16px'}}>
              Click the + button below
            </button>
          </div>
        );
      }

      return (
        <div className="lists-grid">
          {lists.map(list => {
            const taskCount = list.tasks ? Object.keys(list.tasks).length : 0;
            const completedCount = list.tasks ? Object.values(list.tasks).filter(t => t.completed).length : 0;
            
            return (
              <div key={list.id} className="list-card" onClick={() => onListClick(list)}>
                <div className="list-header">
                  <div>
                    <div className="list-title">{list.name}</div>
                    <div className="list-meta">{taskCount} items â€¢ {completedCount} completed</div>
                  </div>
                  <span className={`list-type-badge badge-${list.type}`}>
                    {list.type}
                  </span>
                </div>
                
                {list.tasks && taskCount > 0 && (
                  <div className="task-preview">
                    {Object.keys(list.tasks).slice(0, 3).map(taskId => (
                      <div key={taskId} className="task-preview-item">
                        <div className={`task-checkbox ${list.tasks[taskId].completed ? 'checked' : ''}`}></div>
                        <span>{list.tasks[taskId].name}</span>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      );
    }

    // Modal Component
    function Modal({ onClose, list, task, user }) {
      if (task) {
        return <TaskDetailModal task={task} onClose={onClose} user={user} />;
      }

      if (list) {
        return <ListDetailModal list={list} onClose={onClose} user={user} />;
      }

      return <CreateListModal onClose={onClose} user={user} />;
    }

    // Create List Modal
    function CreateListModal({ onClose, user }) {
      const [formData, setFormData] = useState({
        name: '',
        type: 'task',
        description: ''
      });
      const [loading, setLoading] = useState(false);

      const handleCreateList = async () => {
        if (!formData.name.trim()) return;
        
        setLoading(true);
        try {
          const newList = {
            ...formData,
            owner: user.uid,
            createdAt: Date.now(),
            tasks: {}
          };

          const listRef = firebase.database().ref('lists').push();
          await listRef.set(newList);
          onClose();
        } catch (error) {
          alert('Error creating list: ' + error.message);
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal-content" onClick={(e) => e.stopPropagation()}>
            <div className="modal-header">
              <div className="modal-title">Create New List</div>
              <button className="close-btn" onClick={onClose}>Ã—</button>
            </div>

            <div className="modal-body">
              <div className="form-group">
                <label className="form-label">List Name</label>
                <input
                  type="text"
                  className="form-input"
                  value={formData.name}
                  onChange={(e) => setFormData({...formData, name: e.target.value})}
                  placeholder="e.g., Household Tasks"
                  autoFocus
                />
              </div>

              <div className="form-group">
                <label className="form-label">List Type</label>
                <select
                  className="select-input"
                  value={formData.type}
                  onChange={(e) => setFormData({...formData, type: e.target.value})}
                >
                  <option value="task">Recurring Tasks (with schedules)</option>
                  <option value="inventory">Inventory (with quantities)</option>
                  <option value="checklist">Checklist Tasks (with sub-items)</option>
                </select>
              </div>

              <div className="form-group">
                <label className="form-label">Description (Optional)</label>
                <input
                  type="text"
                  className="form-input"
                  value={formData.description}
                  onChange={(e) => setFormData({...formData, description: e.target.value})}
                  placeholder="What is this list for?"
                />
              </div>

              <button
                className="btn btn-primary"
                onClick={handleCreateList}
                disabled={!formData.name.trim() || loading}
              >
                {loading ? 'Creating...' : 'Create List'}
              </button>
            </div>
          </div>
        </div>
      );
    }

    // List Detail Modal
    function ListDetailModal({ list, onClose, user }) {
      const [newTaskName, setNewTaskName] = useState('');
      const [newTaskRecurrence, setNewTaskRecurrence] = useState('weekly');
      const [loading, setLoading] = useState(false);

      const handleAddTask = async () => {
        if (!newTaskName.trim()) return;

        setLoading(true);
        try {
          const taskRef = firebase.database().ref(`lists/${list.id}/tasks`).push();
          const newTask = {
            name: newTaskName,
            completed: false,
            createdAt: Date.now(),
            createdBy: user.uid
          };

          if (list.type === 'task') {
            newTask.recurrence = newTaskRecurrence;
            newTask.nextDue = Date.now();
          } else if (list.type === 'inventory') {
            newTask.quantity = 1;
          } else if (list.type === 'checklist') {
            newTask.checklist = {};
          }

          await taskRef.set(newTask);
          setNewTaskName('');
        } catch (error) {
          alert('Error adding task: ' + error.message);
        } finally {
          setLoading(false);
        }
      };

      const handleDeleteList = async () => {
        if (!confirm(`Delete "${list.name}"? This cannot be undone.`)) return;
        
        try {
          await firebase.database().ref(`lists/${list.id}`).remove();
          onClose();
        } catch (error) {
          alert('Error deleting list: ' + error.message);
        }
      };

      const tasks = list.tasks ? Object.keys(list.tasks).map(id => ({
        id,
        ...list.tasks[id]
      })) : [];

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal-content" onClick={(e) => e.stopPropagation()}>
            <div className="modal-header">
              <div>
                <div className="modal-title">{list.name}</div>
                <span className={`list-type-badge badge-${list.type}`}>{list.type}</span>
              </div>
              <button className="close-btn" onClick={onClose}>Ã—</button>
            </div>

            <div className="modal-body">
              <div className="form-group">
                <label className="form-label">Add New Item</label>
                <div style={{display: 'flex', gap: '8px'}}>
                  <input
                    type="text"
                    className="form-input"
                    value={newTaskName}
                    onChange={(e) => setNewTaskName(e.target.value)}
                    placeholder="Item name..."
                    onKeyPress={(e) => e.key === 'Enter' && handleAddTask()}
                  />
                  <button className="btn btn-primary" onClick={handleAddTask} disabled={loading}>
                    Add
                  </button>
                </div>
              </div>

              {list.type === 'task' && (
                <div className="form-group">
                  <label className="form-label">Recurrence</label>
                  <select
                    className="select-input"
                    value={newTaskRecurrence}
                    onChange={(e) => setNewTaskRecurrence(e.target.value)}
                  >
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="biweekly">Every 2 weeks</option>
                    <option value="monthly">Monthly</option>
                  </select>
                </div>
              )}

              <div style={{marginTop: '24px'}}>
                <div className="form-label" style={{marginBottom: '12px'}}>
                  Items ({tasks.length})
                </div>
                {tasks.length === 0 ? (
                  <div style={{color: 'var(--text-secondary)', fontSize: '14px', textAlign: 'center', padding: '20px'}}>
                    No items yet. Add one above!
                  </div>
                ) : (
                  <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                    {tasks.map(task => (
                      <TaskItem key={task.id} task={task} listId={list.id} listType={list.type} />
                    ))}
                  </div>
                )}
              </div>

              <div className="share-section">
                <div className="share-title">Danger Zone</div>
                <button className="btn btn-danger" onClick={handleDeleteList}>
                  Delete This List
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Task Item Component
    function TaskItem({ task, listId, listType }) {
      const [showDetail, setShowDetail] = useState(false);

      return (
        <>
          <div 
            className="task-preview-item"
            onClick={() => setShowDetail(true)}
          >
            <div className={`task-checkbox ${task.completed ? 'checked' : ''}`}></div>
            <span style={{flex: 1}}>{task.name}</span>
            {listType === 'inventory' && task.quantity !== undefined && (
              <span style={{fontFamily: 'var(--font-mono)', color: 'var(--text-secondary)'}}>
                Ã—{task.quantity}
              </span>
            )}
          </div>
          
          {showDetail && (
            <TaskDetailModal 
              task={{...task, listId, listType, id: task.id}} 
              onClose={() => setShowDetail(false)} 
            />
          )}
        </>
      );
    }

    // Task Detail Modal
    function TaskDetailModal({ task, onClose }) {
      const [quantity, setQuantity] = useState(task.quantity || 1);
      const [checklist, setChecklist] = useState(task.checklist || {});
      const [newChecklistItem, setNewChecklistItem] = useState('');

      const handleToggleComplete = async () => {
        try {
          await firebase.database().ref(`lists/${task.listId}/tasks/${task.id}`).update({
            completed: !task.completed,
            completedAt: Date.now()
          });
          onClose();
        } catch (error) {
          alert('Error updating task: ' + error.message);
        }
      };

      const handleUpdateQuantity = async (delta) => {
        const newQty = Math.max(0, quantity + delta);
        setQuantity(newQty);
        
        try {
          await firebase.database().ref(`lists/${task.listId}/tasks/${task.id}`).update({
            quantity: newQty
          });
        } catch (error) {
          alert('Error updating quantity: ' + error.message);
        }
      };

      const handleToggleChecklistItem = async (itemId) => {
        const newChecklist = {
          ...checklist,
          [itemId]: {
            ...checklist[itemId],
            checked: !checklist[itemId].checked
          }
        };
        setChecklist(newChecklist);
        
        try {
          await firebase.database().ref(`lists/${task.listId}/tasks/${task.id}`).update({
            checklist: newChecklist
          });
        } catch (error) {
          alert('Error updating checklist: ' + error.message);
        }
      };

      const handleAddChecklistItem = async () => {
        if (!newChecklistItem.trim()) return;
        
        const itemId = 'item_' + Date.now();
        const newChecklist = {
          ...checklist,
          [itemId]: {
            label: newChecklistItem,
            checked: false
          }
        };
        setChecklist(newChecklist);
        setNewChecklistItem('');
        
        try {
          await firebase.database().ref(`lists/${task.listId}/tasks/${task.id}`).update({
            checklist: newChecklist
          });
        } catch (error) {
          alert('Error adding item: ' + error.message);
        }
      };

      const handleDeleteTask = async () => {
        if (!confirm(`Delete "${task.name}"?`)) return;
        
        try {
          await firebase.database().ref(`lists/${task.listId}/tasks/${task.id}`).remove();
          onClose();
        } catch (error) {
          alert('Error deleting task: ' + error.message);
        }
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal-content" onClick={(e) => e.stopPropagation()}>
            <div className="modal-header">
              <div>
                <div className="modal-title">{task.name}</div>
                <span className={`list-type-badge badge-${task.listType}`}>{task.listType}</span>
              </div>
              <button className="close-btn" onClick={onClose}>Ã—</button>
            </div>

            <div className="modal-body">
              {task.listType === 'inventory' && (
                <>
                  <div className="form-label">Quantity</div>
                  <div className="quantity-controls">
                    <button 
                      className="quantity-btn" 
                      onClick={() => handleUpdateQuantity(-1)}
                      disabled={quantity <= 0}
                    >
                      âˆ’
                    </button>
                    <div className="quantity-display">{quantity}</div>
                    <button 
                      className="quantity-btn" 
                      onClick={() => handleUpdateQuantity(1)}
                    >
                      +
                    </button>
                  </div>
                </>
              )}

              {task.listType === 'checklist' && (
                <>
                  <div className="form-label">Checklist Items</div>
                  <div className="checklist-items">
                    {Object.keys(checklist).map(itemId => (
                      <div 
                        key={itemId}
                        className="checklist-item"
                        onClick={() => handleToggleChecklistItem(itemId)}
                      >
                        <div className={`checklist-checkbox ${checklist[itemId].checked ? 'checked' : ''}`}></div>
                        <span className={`checklist-label ${checklist[itemId].checked ? 'checked' : ''}`}>
                          {checklist[itemId].label}
                        </span>
                      </div>
                    ))}
                  </div>
                  
                  <div className="add-checklist-item">
                    <input
                      type="text"
                      className="form-input"
                      value={newChecklistItem}
                      onChange={(e) => setNewChecklistItem(e.target.value)}
                      placeholder="Add sub-item..."
                      onKeyPress={(e) => e.key === 'Enter' && handleAddChecklistItem()}
                    />
                    <button className="btn btn-secondary" onClick={handleAddChecklistItem}>
                      Add
                    </button>
                  </div>
                </>
              )}

              {task.nextDue && (
                <div style={{padding: '12px', background: 'var(--bg-primary)', borderRadius: 'var(--radius-sm)', fontSize: '14px'}}>
                  <div className="form-label" style={{marginBottom: '4px'}}>Next Due</div>
                  <div>{new Date(task.nextDue).toLocaleDateString()}</div>
                  {task.recurrence && (
                    <div style={{color: 'var(--text-secondary)', marginTop: '4px'}}>
                      Repeats: {task.recurrence}
                    </div>
                  )}
                </div>
              )}

              <div className="task-actions">
                <button className="btn btn-primary" onClick={handleToggleComplete}>
                  {task.completed ? 'âœ“ Completed' : 'Mark Complete'}
                </button>
                <button className="btn btn-danger" onClick={handleDeleteTask}>
                  Delete
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Render App
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
